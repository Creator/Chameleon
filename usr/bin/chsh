local program = program

if not program then
  if require then
    program = require 'libprog'
  else
    program = loadfile('/usr/lib/libprog.lua')()
  end

  if not program then
    error('Failed to load program.', 2)
  end
end

local libchsh = libchsh

if not libchsh then
  if require then
    libchsh = require 'libchsh'
  else
    libchsh = loadfile('/usr/lib/libchsh.lua')()
  end

  if not libchsh then
    error('Failed to load libchsh.', 2)
  end
end


if not process.this then
  process.this = (getfenv(2).process.this and getfenv(2).process.this or process.main):spawnSubprocess(_FILE and _FILE or '/usr/bin/chsh')
end


local json = require 'libjson'

local function loadCfg(file)
  local x = fs.open(file, 'r')
  local data = json:decode(x.readAll())
  x.close()

  return data
end

local function writeCfg(file, cfg)
  local x = fs.open(file, 'w')
  x.writeLine(json:encode(cfg))
  x.close()
end

local function mainfnc()
  local inp = (""):lower()

  repeat
    io.write(libchsh.prompt())
    inp = read():lower():split(' ')
    if #inp == 1 then
      io.write(libchsh.prompt())
      inp = read():lower():split(' ')
    else
      libchsh.run(unpack(inp))
    end
  until inp == 'exit'
end

do
  mainfnc()
end
